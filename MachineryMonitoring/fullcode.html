<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATU Machine Monitoring Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyC0ScXmzo0-O2Vsxjpp2nTDmJkLETobEQg",
            authDomain: "v0ai-real.firebaseapp.com",
            databaseURL: "https://v0ai-real-default-rtdb.firebaseio.com",
            projectId: "v0ai-real",
            storageBucket: "v0ai-real.firebasestorage.app",
            messagingSenderId: "151198275979",
            appId: "1:151198275979:web:54cdffc9acc5b246fb378e",
            measurementId: "G-1828HQE7KH"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Alert thresholds (should match your ESP32 code)
        const thresholds = {
            airQuality: { warning: 300, critical: 400, max: 500 },
            vibration: { warning: 500, critical: 800, max: 1000 },
            tiltAngle: { warning: 15, critical: 30, max: 45 },
            temperature: { warning: 35, critical: 40, max: 50 },
            humidity: { warning: 85, critical: 90, max: 100 }
        };

        // Current values
        let currentValues = {
            airQuality: 0,
            vibration: 0,
            tiltAngle: 0,
            temperature: 0,
            humidity: 0,
            location: "Unknown"
        };

        // Historical data for charts
        let historicalData = {
            labels: [],
            airQuality: [],
            vibration: [],
            tiltAngle: [],
            temperature: [],
            humidity: []
        };

        // Gauge charts
        const gauges = {};

        // Initialize gauges
        function initGauges() {
            const gaugeConfigs = {
                airQualityGauge: { label: 'Air Quality', unit: 'PPM', threshold: thresholds.airQuality },
                vibrationGauge: { label: 'Vibration', unit: 'Level', threshold: thresholds.vibration },
                tiltAngleGauge: { label: 'Tilt Angle', unit: '°', threshold: thresholds.tiltAngle },
                temperatureGauge: { label: 'Temperature', unit: '°C', threshold: thresholds.temperature },
                humidityGauge: { label: 'Humidity', unit: '%', threshold: thresholds.humidity }
            };

            for (const [id, config] of Object.entries(gaugeConfigs)) {
                const ctx = document.getElementById(id).getContext('2d');
                
                // Set canvas size
                ctx.canvas.width = 300;
                ctx.canvas.height = 150;
                
                gauges[id] = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [0, config.threshold.max],
                            backgroundColor: ['#28a745', '#e9ecef'],
                            borderWidth: 0,
                            circumference: 180,
                            rotation: 270,
                            borderRadius: 5
                        }]
                    },
                    options: {
                        cutout: '75%',
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        },
                        maintainAspectRatio: false,
                        responsive: true
                    }
                });
            }
        }

        // Update gauge value and color
        function updateGauge(gaugeId, value, threshold) {
            const gauge = gauges[gaugeId];
            let color;
            
            if (value < threshold.warning) {
                color = '#28a745'; // Normal - green
            } else if (value < threshold.critical) {
                color = '#ffc107'; // Warning - yellow
            } else {
                color = '#dc3545'; // Critical - red
            }
            
            gauge.data.datasets[0].backgroundColor[0] = color;
            gauge.data.datasets[0].data[0] = Math.min(value, threshold.max);
            gauge.update();
            
            // Update status text
            const statusElement = document.getElementById(gaugeId.replace('Gauge', 'Status'));
            statusElement.className = 'gauge-status ';
            
            if (value < threshold.warning) {
                statusElement.classList.add('status-normal');
                statusElement.textContent = 'Normal';
            } else if (value < threshold.critical) {
                statusElement.classList.add('status-warning');
                statusElement.textContent = 'Warning';
            } else {
                statusElement.classList.add('status-critical');
                statusElement.textContent = 'Critical';
            }
        }

        // Update system status
        function updateSystemStatus() {
            let hasWarning = false;
            let hasCritical = false;
            
            // Check all values against thresholds
            if (currentValues.airQuality >= thresholds.airQuality.critical ||
                currentValues.vibration >= thresholds.vibration.critical ||
                currentValues.tiltAngle >= thresholds.tiltAngle.critical ||
                currentValues.temperature >= thresholds.temperature.critical ||
                currentValues.humidity >= thresholds.humidity.critical) {
                hasCritical = true;
            } else if (currentValues.airQuality >= thresholds.airQuality.warning ||
                currentValues.vibration >= thresholds.vibration.warning ||
                currentValues.tiltAngle >= thresholds.tiltAngle.warning ||
                currentValues.temperature >= thresholds.temperature.warning ||
                currentValues.humidity >= thresholds.humidity.warning) {
                hasWarning = true;
            }
            
            const systemStatus = document.getElementById('systemStatus');
            const systemStatusIndicator = document.getElementById('systemStatusIndicator');
            const systemStatusMessage = document.getElementById('systemStatusMessage');
            
            if (hasCritical) {
                systemStatus.textContent = 'CRITICAL';
                systemStatus.style.color = '#dc3545';
                systemStatusIndicator.className = 'gauge-status status-critical';
                systemStatusIndicator.textContent = 'Critical Issue';
                systemStatusMessage.textContent = 'Critical issues detected. Immediate action required.';
            } else if (hasWarning) {
                systemStatus.textContent = 'WARNING';
                systemStatus.style.color = '#ffc107';
                systemStatusIndicator.className = 'gauge-status status-warning';
                systemStatusIndicator.textContent = 'Warning';
                systemStatusMessage.textContent = 'Warning conditions detected. Please check system.';
            } else {
                systemStatus.textContent = 'NORMAL';
                systemStatus.style.color = '#28a745';
                systemStatusIndicator.className = 'gauge-status status-normal';
                systemStatusIndicator.textContent = 'System OK';
                systemStatusMessage.textContent = 'All systems are operating within normal parameters.';
            }
        }

        // Initialize historical chart with all parameters
        const historicalChart = new Chart(document.getElementById('historicalChart'), {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Air Quality',
                        data: [],
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Vibration',
                        data: [],
                        borderColor: 'rgb(255, 159, 64)',
                        backgroundColor: 'rgba(255, 159, 64, 0.1)',
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y'
                    },
                    {
                        label: 'Tilt Angle',
                        data: [],
                        borderColor: 'rgb(153, 102, 255)',
                        backgroundColor: 'rgba(153, 102, 255, 0.1)',
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y1'
                    },
                    {
                        label: 'Temperature',
                        data: [],
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y2'
                    },
                    {
                        label: 'Humidity',
                        data: [],
                        borderColor: 'rgb(54, 162, 235)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        tension: 0.3,
                        fill: true,
                        yAxisID: 'y3'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Air Quality / Vibration'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Tilt Angle (°)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    },
                    y2: {
                        type: 'linear',
                        display: false,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Temperature (°C)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    },
                    y3: {
                        type: 'linear',
                        display: false,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Humidity (%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                }
            }
        });

        // Update the historical chart with new data
        function updateHistoricalChart() {
            // Keep only the last 20 data points
            if (historicalData.labels.length > 20) {
                historicalData.labels.shift();
                historicalData.airQuality.shift();
                historicalData.vibration.shift();
                historicalData.tiltAngle.shift();
                historicalData.temperature.shift();
                historicalData.humidity.shift();
            }
            
            // Update chart data
            historicalChart.data.labels = historicalData.labels;
            historicalChart.data.datasets[0].data = historicalData.airQuality;
            historicalChart.data.datasets[1].data = historicalData.vibration;
            historicalChart.data.datasets[2].data = historicalData.tiltAngle;
            historicalChart.data.datasets[3].data = historicalData.temperature;
            historicalChart.data.datasets[4].data = historicalData.humidity;
            
            historicalChart.update();
        }

        // Fetch historical data from Firebase
        function fetchHistoricalData(date) {
            const tableBody = document.getElementById('historyTableBody');
            tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4"><div class="spinner-border text-primary" role="status"></div></td></tr>';
            
            const datePath = `Machinery/sensor_data/${date}`;
            const dataRef = ref(database, datePath);
            
            onValue(dataRef, (snapshot) => {
                const data = snapshot.val();
                tableBody.innerHTML = '';
                
                if (!data) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">No data available for selected date</td></tr>';
                    return;
                }
                
                // Convert object to array and sort by time
                const dataArray = Object.entries(data).map(([time, values]) => ({
                    time,
                    ...values
                })).sort((a, b) => a.time.localeCompare(b.time));
                
                // Populate table
                dataArray.forEach(item => {
                    const row = document.createElement('tr');
                    
                    // Determine overall status for this reading
                    let status = 'normal';
                    if (item.air_quality >= thresholds.airQuality.critical ||
                        item.vibration >= thresholds.vibration.critical ||
                        item.tilt_angle >= thresholds.tiltAngle.critical ||
                        item.temperature >= thresholds.temperature.critical ||
                        item.humidity >= thresholds.humidity.critical) {
                        status = 'critical';
                    } else if (item.air_quality >= thresholds.airQuality.warning ||
                               item.vibration >= thresholds.vibration.warning ||
                               item.tilt_angle >= thresholds.tiltAngle.warning ||
                               item.temperature >= thresholds.temperature.warning ||
                               item.humidity >= thresholds.humidity.warning) {
                        status = 'warning';
                    }
                    
                    let statusBadge = '';
                    if (status === 'normal') {
                        statusBadge = '<span class="status-badge" style="background-color: #28a745; color: white;">Normal</span>';
                    } else if (status === 'warning') {
                        statusBadge = '<span class="status-badge" style="background-color: #ffc107; color: black;">Warning</span>';
                    } else {
                        statusBadge = '<span class="status-badge" style="background-color: #dc3545; color: white;">Critical</span>';
                    }
                    
                    row.innerHTML = `
                        <td>${item.time}</td>
                        <td>${item.air_quality || '--'}</td>
                        <td>${item.vibration || '--'}</td>
                        <td>${item.tilt_angle ? item.tilt_angle.toFixed(1) : '--'}</td>
                        <td>${item.temperature ? item.temperature.toFixed(1) : '--'}</td>
                        <td>${item.humidity ? item.humidity.toFixed(1) : '--'}</td>
                        <td>${statusBadge}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
            }, (error) => {
                console.error('Error fetching historical data:', error);
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">Error loading data</td></tr>';
            });
        }

        // Setup real-time listener for latest data
        function setupRealtimeListener() {
            const latestDataRef = ref(database, 'Machinery/latest_reading');
            
            onValue(latestDataRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    // Update current values
                    currentValues.airQuality = data.air_quality || 0;
                    currentValues.vibration = data.vibration || 0;
                    currentValues.tiltAngle = data.tilt_angle || 0;
                    currentValues.temperature = data.temperature || 0;
                    currentValues.humidity = data.humidity || 0;
                    currentValues.location = data.location || "Unknown";
                    
                    // Update gauges
                    updateGauge('airQualityGauge', currentValues.airQuality, thresholds.airQuality);
                    updateGauge('vibrationGauge', currentValues.vibration, thresholds.vibration);
                    updateGauge('tiltAngleGauge', currentValues.tiltAngle, thresholds.tiltAngle);
                    updateGauge('temperatureGauge', currentValues.temperature, thresholds.temperature);
                    updateGauge('humidityGauge', currentValues.humidity, thresholds.humidity);
                    
                    // Update numeric values
                    document.getElementById('airQualityValue').textContent = currentValues.airQuality;
                    document.getElementById('vibrationValue').textContent = currentValues.vibration;
                    document.getElementById('tiltAngleValue').textContent = currentValues.tiltAngle.toFixed(1);
                    document.getElementById('temperatureValue').textContent = currentValues.temperature.toFixed(1);
                    document.getElementById('humidityValue').textContent = currentValues.humidity.toFixed(1);
                    document.getElementById('location').textContent = currentValues.location;
                    
                    // Update system status
                    updateSystemStatus();
                    
                    // Add to historical data for chart
                    const now = new Date();
                    const timeLabel = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds();
                    
                    historicalData.labels.push(timeLabel);
                    historicalData.airQuality.push(currentValues.airQuality);
                    historicalData.vibration.push(currentValues.vibration);
                    historicalData.tiltAngle.push(currentValues.tiltAngle);
                    historicalData.temperature.push(currentValues.temperature);
                    historicalData.humidity.push(currentValues.humidity);
                    
                    updateHistoricalChart();
                    
                    // Update last updated time
                    document.getElementById('lastUpdate').textContent = 'Last updated: ' + now.toLocaleTimeString();
                }
            }, (error) => {
                console.error('Error in real-time listener:', error);
            });
        }

        // Initialize the dashboard
        function initDashboard() {
            initGauges();
            setupRealtimeListener();
            
            // Set today's date as default
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('dateSelector').value = formattedDate;
            
            // Fetch today's historical data by default
            fetchHistoricalData(formattedDate);
            
            // Add event listener for fetch button
            document.getElementById('fetchHistoryBtn').addEventListener('click', () => {
                const selectedDate = document.getElementById('dateSelector').value;
                if (selectedDate) {
                    fetchHistoricalData(selectedDate);
                }
            });
            
            // Update countdown timer
            let countdown = 10;
            setInterval(() => {
                countdown--;
                if (countdown === 0) countdown = 10;
                document.getElementById('updateTimer').textContent = 'Data updates in real-time';
            }, 1000);
        }

        // Start the dashboard when page loads
        window.onload = initDashboard;
    </script>
    <style>
        :root {
            --normal: #28a745;
            --warning: #ffc107;
            --critical: #dc3545;
            --card-bg: #ffffff;
            --body-bg: #f8f9fa;
            --text-dark: #212529;
            --text-light: #6c757d;
        }

        body {
            background-color: var(--body-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-bottom: 20px;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6580 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 25px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 25px;
            border: none;
            background-color: var(--card-bg);
            height: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
        }

        .gauge-container {
            position: relative;
            width: 100%;
            height: 140px;
            margin: 10px 0 20px;
        }

        .gauge-value {
            position: absolute;
            top: 85%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 700;
            z-index: 10;
            text-align: center;
            width: 100%;
        }

        .gauge-unit {
            font-size: 1rem;
            color: var(--text-light);
            margin-left: 2px;
        }

        .gauge-label {
            text-align: center;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .gauge-status {
            text-align: center;
            font-size: 0.9rem;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 10px;
        }

        .status-normal {
            background-color: rgba(40, 167, 69, 0.15);
            color: var(--normal);
        }

        .status-warning {
            background-color: rgba(255, 193, 7, 0.15);
            color: var(--warning);
        }

        .status-critical {
            background-color: rgba(220, 53, 69, 0.15);
            color: var(--critical);
        }

        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .system-status-card {
            background: linear-gradient(135deg, #4a6580 0%, #2c3e50 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .last-updated {
            font-size: 0.9rem;
            color: var(--text-light);
            text-align: right;
            padding: 10px 15px;
        }

        .location-display {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 8px 18px;
            font-size: 0.9rem;
            display: inline-block;
            margin-left: 15px;
        }

        .history-controls {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .table th {
            position: sticky;
            top: 0;
            background-color: #4a6580;
            color: white;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .sensor-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .gauge-value {
                font-size: 1.7rem;
            }
            
            .gauge-label {
                font-size: 1rem;
            }
            
            .card {
                margin-bottom: 15px;
            }
        }

        @media (max-width: 576px) {
            .sensor-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .location-display {
                margin-top: 10px;
                margin-left: 0;
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="container">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
                <div class="d-flex align-items-center mb-3 mb-md-0">
                    <div class="display-5 me-3"><i class="fas fa-industry"></i></div>
                    <div>
                        <h1 class="h3 mb-0">ATU Machine Monitoring</h1>
                        <p class="mb-0">Real-time Machinery & Environment Monitoring System</p>
                    </div>
                </div>
                <div class="text-center text-md-end">
                    <div class="location-display">
                        <i class="fas fa-map-marker-alt me-2"></i> <span id="location">Loading...</span>
                    </div>
                    <div class="text-white-50 mt-2" id="lastUpdate">Last updated: Just now</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Sensor Cards Grid -->
        <div class="sensor-grid">
            <!-- Air Quality Card -->
            <div class="card">
                <div class="card-body">
                    <div class="gauge-label">
                        <i class="fas fa-wind me-2"></i> Air Quality
                    </div>
                    <div class="gauge-container">
                        <canvas id="airQualityGauge"></canvas>
                        <div class="gauge-value"><span id="airQualityValue">--</span><span class="gauge-unit">PPM</span></div>
                    </div>
                    <div class="text-center">
                        <span class="gauge-status status-normal" id="airQualityStatus">Normal</span>
                    </div>
                </div>
            </div>

            <!-- Vibration Card -->
            <div class="card">
                <div class="card-body">
                    <div class="gauge-label">
                        <i class="fas fa-vibration me-2"></i> Vibration
                    </div>
                    <div class="gauge-container">
                        <canvas id="vibrationGauge"></canvas>
                        <div class="gauge-value"><span id="vibrationValue">--</span><span class="gauge-unit">Level</span></div>
                    </div>
                    <div class="text-center">
                        <span class="gauge-status status-normal" id="vibrationStatus">Normal</span>
                    </div>
                </div>
            </div>

            <!-- Tilt Angle Card -->
            <div class="card">
                <div class="card-body">
                    <div class="gauge-label">
                        <i class="fas fa-angle-double-right me-2"></i> Tilt Angle
                    </div>
                    <div class="gauge-container">
                        <canvas id="tiltAngleGauge"></canvas>
                        <div class="gauge-value"><span id="tiltAngleValue">--</span><span class="gauge-unit">°</span></div>
                    </div>
                    <div class="text-center">
                        <span class="gauge-status status-normal" id="tiltAngleStatus">Normal</span>
                    </div>
                </div>
            </div>

            <!-- Temperature Card -->
            <div class="card">
                <div class="card-body">
                    <div class="gauge-label">
                        <i class="fas fa-temperature-high me-2"></i> Temperature
                    </div>
                    <div class="gauge-container">
                        <canvas id="temperatureGauge"></canvas>
                        <div class="gauge-value"><span id="temperatureValue">--</span><span class="gauge-unit">°C</span></div>
                    </div>
                    <div class="text-center">
                        <span class="gauge-status status-normal" id="temperatureStatus">Normal</span>
                    </div>
                </div>
            </div>

            <!-- Humidity Card -->
            <div class="card">
                <div class="card-body">
                    <div class="gauge-label">
                        <i class="fas fa-tint me-2"></i> Humidity
                    </div>
                    <div class="gauge-container">
                        <canvas id="humidityGauge"></canvas>
                        <div class="gauge-value"><span id="humidityValue">--</span><span class="gauge-unit">%</span></div>
                    </div>
                    <div class="text-center">
                        <span class="gauge-status status-normal" id="humidityStatus">Normal</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status Card -->
        <div class="system-status-card">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h3 class="h5 mb-2">Overall System Status</h3>
                    <p class="mb-0" id="systemStatusMessage">All systems are operating within normal parameters</p>
                </div>
                <div class="col-md-4 text-center text-md-end">
                    <div class="display-4 fw-bold mb-1" id="systemStatus">NORMAL</div>
                    <div class="gauge-status status-normal" id="systemStatusIndicator">System OK</div>
                </div>
            </div>
        </div>

        <!-- Historical Data Chart -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title mb-4">
                    <i class="fas fa-chart-line me-2"></i> Historical Data Trends
                </h5>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="historicalChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Historical Data Table Section -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title mb-4">
                    <i class="fas fa-history me-2"></i> Historical Data Log
                </h5>
                
                <div class="history-controls mb-4">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="dateSelector" class="form-label">Select Date:</label>
                            <div class="input-group">
                                <input type="date" class="form-control" id="dateSelector">
                                <button class="btn btn-primary" type="button" id="fetchHistoryBtn">
                                    <i class="fas fa-search me-1"></i> Fetch Data
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6 d-flex align-items-end">
                            <div class="form-text">Select a date to view historical sensor data</div>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Air Quality (PPM)</th>
                                <th>Vibration</th>
                                <th>Tilt Angle (°)</th>
                                <th>Temperature (°C)</th>
                                <th>Humidity (%)</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="7" class="text-center py-4">Select a date to load historical data</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="last-updated">
            <i class="fas fa-sync-alt me-1"></i> <span id="updateTimer">Data updates in real-time</span>
        </div>
    </div>
</body>
</html>